<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="I often find myself spawning random EC2 instances or DigitalOcean FreeBSD
droplets for prototyping web services. Just because they are temporary does not
mean that they should not have secure defaults">
<meta property="og:type" content="article">
<meta property="og:title" content="Bootstrap sane defaults for sshd and ipfw">
<meta property="og:url" content="http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/index.html">
<meta property="og:site_name" content="stty.io">
<meta property="og:description" content="I often find myself spawning random EC2 instances or DigitalOcean FreeBSD
droplets for prototyping web services. Just because they are temporary does not
mean that they should not have secure defaults">
<meta property="og:updated_time" content="2017-03-09T09:52:07.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bootstrap sane defaults for sshd and ipfw">
<meta name="twitter:description" content="I often find myself spawning random EC2 instances or DigitalOcean FreeBSD
droplets for prototyping web services. Just because they are temporary does not
mean that they should not have secure defaults">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Bootstrap sane defaults for sshd and ipfw</title>
    <!-- styles -->
    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/lib/meslo-LG/styles.css">
    <link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
    <!-- jquery -->
    <script src="/lib/jquery/jquery.min.js"></script>
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/spaghetti-">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/03/23/finding-duplicate-records-across-databases/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/2017/01/19/say-no-to-catkin-make/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&text=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&title=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&is_video=false&description=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Bootstrap sane defaults for sshd and ipfw&body=Check out this article: http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&title=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&title=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&title=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&title=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&name=Bootstrap sane defaults for sshd and ipfw&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Bootstrap sane defaults for sshd and ipfw
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">alex</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-03-09T09:34:54.000Z" itemprop="datePublished">2017-03-09</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/freebsd/">freebsd</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>I often find myself spawning random EC2 instances or DigitalOcean FreeBSD
droplets for prototyping web services. Just because they are temporary does not
mean that they should not have secure defaults however. Hereâ€™s a short script
that sets up <code>sshd</code> as well as initializes the <code>ipfw</code> firewall.</p>
<p>It can be run using</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh user@host <span class="string">'sh -s'</span> &lt; script</div></pre></td></tr></table></figure>
<p>It disables password authentication and allows only public key based
authentication, disables root login, limits retries. As for ipfw, it only allows
tcp in on port 22 by default. </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line">head -1 ~/.ssh/authorized_keys | ssh-keygen <span class="_">-l</span> <span class="_">-f</span> - &gt; /dev/null 2&gt;&amp;1</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ $? != 0 ];</div><div class="line"><span class="keyword">then</span></div><div class="line">  <span class="built_in">echo</span> <span class="string">"invalid public key found in authorized_keys, exiting.."</span></div><div class="line">  <span class="built_in">exit</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">cp /etc/ssh/sshd_config ~/sshd_config.bak</div><div class="line"></div><div class="line">sudo tee /etc/ssh/sshd_config &lt;&lt;EOF</div><div class="line">Port 22</div><div class="line">SyslogFacility AUTH</div><div class="line">LogLevel INFO</div><div class="line">LoginGraceTime 2m</div><div class="line">StrictModes yes</div><div class="line">MaxAuthTries 6</div><div class="line">MaxSessions 10</div><div class="line">RSAAuthentication yes</div><div class="line">PubkeyAuthentication yes</div><div class="line">AuthorizedKeysFile .ssh/authorized_keys .ssh/authorized_keys2</div><div class="line">PasswordAuthentication no</div><div class="line">PermitEmptyPasswords no</div><div class="line">Subsystem       sftp    /usr/libexec/sftp-server</div><div class="line">PermitRootLogin no</div><div class="line">EOF</div><div class="line"></div><div class="line">sudo tee <span class="_">-a</span> /etc/rc.conf &lt;&lt;EOF</div><div class="line">firewall_enable=<span class="string">"YES"</span></div><div class="line">firewall_quiet=<span class="string">"YES"</span></div><div class="line">firewall_type=<span class="string">"workstation"</span></div><div class="line">firewall_myservices=<span class="string">"22/tcp"</span></div><div class="line">firewall_allowservices=<span class="string">"any"</span></div><div class="line">firewall_logdeny=<span class="string">"YES"</span></div><div class="line">EOF</div><div class="line"></div><div class="line">sudo service sshd restart</div><div class="line">sudo service ipfw start</div></pre></td></tr></table></figure>
<p>A maintained version of this script can be found on
<a href="https://gist.github.com/spaghetti-/40896fb8f6cdc56851f894291d149ae5" target="_blank" rel="external">gist</a>.</p>
<p>The blog syntax highlighter seems to remove newlines from the source.</p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/spaghetti-">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&text=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&title=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&is_video=false&description=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Bootstrap sane defaults for sshd and ipfw&body=Check out this article: http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&title=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&title=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&title=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&title=Bootstrap sane defaults for sshd and ipfw"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://stty.io/2017/03/09/sane-sshd-ipfw-defaults/&name=Bootstrap sane defaults for sshd and ipfw&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 Alex
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/spaghetti-">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    <script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

<!-- Disqus Comments -->


</body>
</html>
